<!DOCTYPE html>
<html manifest="manifest.appcache">

<head>
    <title>MiSmart</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/styles.css">
    <script type="text/javascript" src="js/config.js"></script>
    <script type="text/javascript" src="js/cors.js"></script>
    <script type="text/javascript" src="js/mavlink.js"></script>
</head>

<body>

    <p><a href="index.html"><img src="images/main_logo.png" alt="ArduPilot" width="500"></a></p>

    <h2>Flight Hub</h2>
    <label for="token">Device token:</label>
    <input id="token" type="text"><br>
    <button id="submitButton"> Submit</button>

    <script>
        var tokenInput = document.getElementById("token");
        var submitButton = document.getElementById("submitButton");
        fetch(drone_url + '/ajax/token.json').then(async (resp) => {
            const data = await resp.text()
            console.log(data);
            tokenInput.value = data;
        });

        submitButton.onclick = async function () {
            var token = tokenInput.value;
            console.log(token);
            const formData = new FormData();
            formData.append("command1", token);
            fetch(drone_url + '/ajax/set_token_command.json', {
                method: 'post',
                body: formData,
            }).then((resp) => {
                alert('Token updated');
            })
        }
    </script>

</body>

</html>